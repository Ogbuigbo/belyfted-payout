on:
  push:
    branches:
      - development
  pull_request:
    branches:
      - development
    types: [closed]

name: ðŸš€ CI/CD Deployment pipeline for Sheqelpay frontend(Stagging)

jobs:
  web-deploy:
    name: ðŸŽ‰ Stagging Deployment
    runs-on: ubuntu-latest
    steps:
      - name: ðŸšš Get latest code
        uses: actions/checkout@v4

      # - name: Set up Node.js
      #   uses: actions/setup-node@v2
      #   with:
      #     node-version: 18.20.8  # Use the desired Node.js version

      # - name: Install dependencies and build Next.js app
      #   run: |
      #     npm install  # Install project dependencies
      #     npm run build  # Build Next.js app

      - name: ðŸ“‚ Sync files and deploying via FTPS
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server:   ${{ secrets.FTP_HOST }}
          username: ${{ secrets.username_staging_frontend }}
          password: ${{ secrets.password_staging_frontend }}
          local-dir: ./  # This points to the build output directory of your Next.js app
          exclude: |
            **/.git*
            **/.git*/**
            **/.env**
            **/node_modules/**
            .env
            .htaccess
  notify:
    needs: web-deploy
    runs-on: ubuntu-latest
    steps:
      - name: Post build notification in slack channel
        uses: slackapi/slack-github-action@v2.1.0
        with:
          webhook: ${{ secrets.SLACK_DEPLOYMENT_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            text: "*Sheqelpay Frontend(Staging) CI/CD Deployment Result"
            blocks:
              - type: "section"
                text:
                  type: "mrkdwn"
                  text: "Belyfted Remittance Frontend(Staging) CI/CD Deployment Result: \n\n *Status:* ${{ job.status }} \n\n *PR/Commit URL:* ${{ github.event.pull_request.html_url || github.event.head_commit.url }} \n\n *Branch:* ${{ github.ref }} \n\n *Repository:* ${{ github.repository }} \n\n *P.R Reviewer*: ERNEST \n\n *Live At:* https://staging.sheqelpay.com"